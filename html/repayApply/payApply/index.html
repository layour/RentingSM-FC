<!DOCTYPE html>
<html>

<head>
	<meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1">
	<meta charset="UTF-8">
	<title></title>
	<link rel="stylesheet" href="../../../css/iuapmobile.um.css">
	<link rel="stylesheet" href="../../../css/fonts/iconfont.css">
	<link rel="stylesheet" href="index.css">
	<script src="../../../js/summer.js"></script>
	<script src="../../../js/jquery.min.js"></script>
	<script src="../../../js/Frameworks/iuapmobile.frameworks.ui.js"></script>
	<script src="../../../js/font.js"></script>
	<script src="../../../js/vue.js" ></script>
	<script src="../../../js/common.js"></script>
</head>

<body>
	<div class="um-win" id="index">
		<div class="um-content" v-bind:style="[datas ? {'display':'block'} : {'display':'none'}]">
			<ul class="applyList">
				<li>
					<span class="title">
							<i></i>
							<b>{{datas ? datas.TABLE_HEAD.RENTER_NAME : ""}}</b>
						</span>
					<div class="first">{{datas ? datas.PAYBANKINFO.ACCOUNT_NO : ""}}</div>
				</li>
				<li>
					<span>融资租赁合同号</span>
					<div>{{datas ? datas.TABLE_HEAD.LEASE_CODE : ""}}</div>
				</li>
				<li>
					<span>支付表号</span>
					<div>{{datas ? datas.TABLE_HEAD.PAYLIST_CODE : ""}}</div>
				</li>
				<li>
					<span>车型</span>
					<div>{{datas ? datas.LEASEOBJ[0].THING_NAME : ""}}</div>
				</li>
				<li>
					<span>价格</span>
					<div>￥<strong>{{datas ? datas.LEASEOBJ[0].TOTAL : ""}}</strong>元</div>
				</li>
				<li>
					<span>留购价</span>
					<div>￥<strong>{{datas ? datas.LEASEOBJ[0].STAYBUY_PRICE : ""}}</strong>元</div>
				</li>
				<li>
					<span>经销商</span>
					<div></div>
				</li>
				<li class="change">
					<span>保险</span>
					<div onclick="addWarranty()">
						<span class="iconfont icon-enter"></span>
						<i>添加保单</i>
					</div>
				</li>
				<li class="change">
					<span>合格证</span>
					<div onclick="addCertificate()">
						<span class="iconfont icon-enter"></span>
						<i>添加合格证</i>
					</div>
				</li>
				<li class="change">
					<span>付款审核资料</span>
					<div onclick="toUpload()">
						<span class="iconfont icon-enter"></span>
						<i>开始上传</i>
					</div>
				</li>
			</ul>
			<div class="applyBtn" @click="toApply">立即申请付款</div>
		</div>
	</div>
	<script type="text/javascript">
		var payApply = new Vue({
			el: '#index',
			data: {
				datas: null,
				PROJECT_ID:""
			},
			methods:{
				// 立即申请付款
				toApply() {
					summer.showProgress();
					ajaxRequest({
						type: 'post',
						url: 'appservice/business/startRevJbpm',
						param: {
							"PROJECT_ID": this.PROJECT_ID
						}
					}, function(res) {
						summer.hideProgress();
						var Data;
						if (Object.prototype.toString.call(res.data) === '[object String]') {
							Data = JSON.parse(res.data);
						} else {
							Data = res.data;
						}
						if (Data.flag == 1) {
							if (Data.datas.JBPM_ID) {
								summer.toast({
									msg: "申请成功"
								});
								summer.closeToWin({
									id: 'payList'
								});
							} else if (Data.datas.data) {
								alert(Data.datas.data);
								summer.toast({
									msg: Data.datas.data
								});
							}
						} else {
							summer.toast({
								msg: Data.msg
							});
						}
					}, function(err) {
						summer.hideProgress();
						summer.toast({
							msg: "申请失败"
						});
						console.log(err);
					});
				}
			}
		});
		// 接添加保险参数
		function saveWarranty(insurer, warrantyMoney, warrantyImg) {
			// alert(insurer + warrantyMoney + warrantyImg);
		}
		summerready = function() {
			var show = summer.pageParam.show;
			if (show) {
				$('.change').css('display', 'block');
				$('.applyBtn').css('top', '9.8rem');
			}
			var userId = summer.pageParam.userId;
			var PROJECT_ID = summer.pageParam.PROJECT_ID;
			payApply.PROJECT_ID = PROJECT_ID;
			summer.showProgress();
			ajaxRequest({
				type: 'post',
				url: 'appservice/paytable/payinfo',
				param: {
					"id": userId
				}
			}, function(res) {
				summer.hideProgress();
				var Data;
				if (Object.prototype.toString.call(res.data) === '[object String]') {
					Data = JSON.parse(res.data);
				} else {
					Data = res.data;
				}
				if (Data.flag == 1) {
					payApply.datas = Data.datas;
				} else {
					summer.toast({
						msg: Data.msg
					});
				}
			}, function(err) {
				summer.hideProgress();
				summer.toast({
					msg: "暂无数据"
				});
				console.log(err);
			});
		};
		// 立即申请付款
		/*function toApply() {
			summer.closeToWin({
				id: 'payList'
			});
		}*/
		// 添加保单
		function addWarranty() {
			summer.openWin({
				id: 'warranty',
				url: 'html/repayApply/addWarranty/index.html',
				create: false,
				type: 'actionBar',
				actionBar: {
					title: "添加保险",
					titleColor: "#ffffff", //注意必须是6位数的颜色值。（3位数颜色值会不正常）
					backgroundColor: "#039be5",
					leftItem: {
						image: "img/back.png",
						method: "", //返回按钮自定义事件
						text: "返回",
						textColor: "#ffffff" //返回文字颜色，注意必须是6位数的颜色值。（3位数颜色值会不正常）
					},
					rightItems: [{
						type: "text",
						text: "保存",
						textColor: "#ffffff",
						method: "addWarranty.save()"
					}]
				}
			});
		}
		// 添加合格证
		function addCertificate() {
			summer.openWin({
				id: 'certificate',
				url: 'html/repayApply/addCertificate/index.html',
				create: false,
				type: 'actionBar',
				actionBar: {
					title: "添加合格证",
					titleColor: "#ffffff", //注意必须是6位数的颜色值。（3位数颜色值会不正常）
					backgroundColor: "#039be5",
					leftItem: {
						image: "img/back.png",
						method: "", //返回按钮自定义事件
						text: "返回",
						textColor: "#ffffff" //返回文字颜色，注意必须是6位数的颜色值。（3位数颜色值会不正常）
					},
					rightItems: [{
						type: "text",
						text: "保存",
						textColor: "#ffffff",
						method: "addCertificate.save()"
					}]
				}
			});
		}
		// 跳转到上传页
		function toUpload() {
			summer.openWin({
				id: 'uploadImg',
				url: 'html/fastReport/uploadImg.html',
				create: false,
				type: 'actionBar',
				actionBar: {
					title: "资料上传",
					titleColor: "#ffffff",
					backgroundColor: "#039BE5",
					leftItem: {
						image: "img/back.png",
						method: "",
						text: "返回",
						textColor: "#ffffff"
					},
					rightItems: [{
						type: "text",
						text: "保存",
						textColor: "#ffffff",
						method: "save()"
					}]
				}
			});
		};
	</script>
</body>

</html>
