<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1">
		<meta charset="UTF-8">
		<title>添加车辆</title>
		<link rel="stylesheet" href="../../css/iuapmobile.um.css">
		<link rel="stylesheet" href="../../css/fonts/iconfont.css">
		<link rel="stylesheet" href="../../css/mint.css">
		<link rel="stylesheet" href="./car.min.css">
		<script src="../../js/summer.js" ></script>
		<script src="../../js/jquery.min.js" ></script>
		<script src="../../js/font.js" ></script>
		<script src="../../js/vue.js" ></script>
		<script src="../../js/mint.js" ></script>
		<script src="../../js/Frameworks/iuapmobile.frameworks.ui.js" ></script>
	</head>
	<body>
		<div class="um-win" id="addCar" v-cloak>
			<div class="um-content addCar">
        <table>
          <tr @click="pickerDealer">
            <td>经销商</td>
            <td>
							<span v-if='dealer'>{{dealer}}</span><span class="grayColor" v-else>请选择</span>
							<i class="icon iconfont icon-enter"></i>
						</td>
          </tr>
					<tr @click="pickerCompany">
            <td>厂商</td>
            <td>
							<span v-if='company'>{{company}}</span><span class="grayColor" v-else>请选择</span>
							<i class="icon iconfont icon-enter"></i>
						</td>
          </tr>
					<tr @click="surePickerColor">
            <td>车辆状况</td>
            <!-- <td>车辆颜色</td> -->
            <td>
							<span v-if='color'>{{color}}</span><span  class="grayColor" v-else>请选择</span>
							<i class="icon iconfont icon-enter"></i>
						</td>
          </tr>
					<tr @click="pickerModels">
            <td>选择车型</td>
            <td>
							<span v-if='carModels'>{{carModels}}</span><span class="grayColor"  v-else>请选择</span>
							<i class="icon iconfont icon-enter"></i>
						</td>
          </tr>
					<tr>
            <td>新车指导价</td>
            <td>
							<input type="text" @input="checkNumber($event,'guidePrice')" name="price" placeholder="请输入指导价" v-model="guidePrice">
						</td>
					</tr>
					<tr>
            <td>留购价</td>
            <td>
							<input type="text" @input="checkNumber($event,'holdPrice')" name="holdPrice" placeholder="请输入留购价" v-model="holdPrice">
						</td>
					</tr>
        </table>
				<mt-popup v-model="pickerColorStatus" position='bottom' class="pickerColor">
					<mt-picker :slots="slots" @change="onValuesChange"></mt-picker>
					<p><span class="" @click="surePickerColor">取消</span><span class="" @click="surePickerColor('confirm')">确定</span></p>
				</mt-popup>
			</div>
		</div>
		<script>
				var addCar=new Vue({
					el:'#addCar',
					data(){
						return{
							dealer:'',
							company:'',
							carStatus:'new',
							carModels:'',
							color:'',
							guidePrice:'',
							holdPrice:'100',
							pickerColorStatus:false,
							pickedColor:'',
							slots: [
								{
									flex: 1,
									values: ['中重卡','轻卡','二手车'],
									defaultIndex:0,
									className: 'slot1',
									textAlign: 'center'
								}
							]
						}
					},
					created(){

					},
					methods:{
						checkNumber(e,param){
							var val=$(e.currentTarget).val()
							if(!/^([1-9]\d{0,9}|0)([.]?|(\.\d{1,2})?)$/.test(val)){
								if(param=='guidePrice'){
									this.guidePrice=''
								}else{
									this.holdPrice=''
								}
							}
						},
						pickerDealer(){
							summer.openWin({
								id:'pickerDealer',
								url:'html/touristsClient/pickerDealer.html',
								create:false,
								type:'actionBar',
								actionBar: {
						      title: "选择经销商",
						      titleColor: "#ffffff",
						      backgroundColor: "#039BE5",
						      leftItem:{
						          image: "img/back.png",
						          method:'',
						          text:"返回",
						          textColor:"#ffffff"
						      }
								}
							})
						},
						pickerCompany(){
							var dealer=summer.getStorage('pickerDealer');
							if(dealer){
								summer.openWin({
									id:'pickerCompany',
									url:'html/touristsClient/pickCompany.html',
									create:false,
									type:'actionBar',
									pageParam:{id:JSON.parse(dealer).SUPPLIERS_ID},
									actionBar: {
										title: "选择厂商",
										titleColor: "#ffffff",
										backgroundColor: "#039BE5",
										leftItem:{
												image: "img/back.png",
												method:'',
												text:"返回",
												textColor:"#ffffff"
										}
									}
								})
							}else{
								summer.toast({msg:'请先选择经销商'})
							}
						},
						pickerModels(){
							var company=summer.getStorage('pickerCompany');
							if(company){
								summer.openWin({
									id:'pickerModels',
									url:'html/touristsClient/pickerModels.html',
									create:false,
									type:'actionBar',
									pageParam:{id:JSON.parse(company).COMPANY_ID},
									actionBar: {
							      title: "选择车型",
							      titleColor: "#ffffff",
							      backgroundColor: "#039BE5",
							      leftItem:{
							          image: "img/back.png",
							          method:'',
							          text:"返回",
							          textColor:"#ffffff"
							      }
									}
								})
							}else {
								summer.toast({msg:'请先选择厂商'})
							}
						},
						changCarStatus(e,status){
							$(e.currentTarget).addClass('active').siblings('.active').removeClass('active');
							this.carStatus=status;
						},
						onValuesChange(picker,values) {
							this.pickedColor=values[0];
				    },
						surePickerColor(param){
							this.pickerColorStatus=!this.pickerColorStatus;
							if(param=='confirm'){
								this.color=this.pickedColor;
							}
						},
						save(){
							summer.execScript({
							    winId: "setProject",
							    script: "addRight('addCar')"
							});
							summer.closeWin()
						}
					}
				});
				function getDealer(){
					var dealer=summer.getStorage('pickerDealer');
					console.log(dealer);
					if(dealer){
						addCar.dealer=JSON.parse(dealer).SUPPLIERS_NAME;
					}
				}
				function getCompany(){
					var company=summer.getStorage('pickerCompany');
					console.log(company);
					if(company){
						addCar.company=JSON.parse(company).COMPANY_NAME;
					}
				}
				function getModels(){
					var models=summer.getStorage('pickerModels3');
					if(models){
						addCar.carModels=JSON.parse(summer.getStorage('pickerModels1')).PRODUCT_NAME+JSON.parse(summer.getStorage('pickerModels2')).CATENA_NAME+JSON.parse(models).NAME;
					}
				}
				function save(){
					addCar.save()
				}
		</script>
	</body>
</html>
