<!DOCTYPE html>
<html>

<head>
	<meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1">
	<meta charset="UTF-8">
	<title></title>
	<link rel="stylesheet" href="../../css/iuapmobile.um.css">
	<link rel="stylesheet" href="../../css/fonts/iconfont.css">
	<link rel="stylesheet" href="stock.css">
	<script src="../../js/summer.js"></script>
	<script src="../../js/jquery.min.js"></script>
	<script src="../../js/Frameworks/iuapmobile.frameworks.ui.js"></script>
	<script src="../../js/font.js" charset="utf-8"></script>
    <script src="../../js/vue.js" charset="utf-8"></script>
</head>

<body>
	<div class="um-win" id="index">
		<!-- 底部遮罩弹层 -->
		<div v-bind:class="botMaskStyle">
			<div class="t-con" @click="closeMask"></div>
			<div v-bind:class="choosePayMethodStyle">
				<div class="headBar">
					<span class="iconfont icon-wrong1" @click="closeMask"></span>
					<div v-bind:class="[isTestPhNum ? 'notShowIt' : '']">选择付款方式</div>
					<div v-bind:class="[isTestPhNum ? '' : 'notShowIt']">手机号验证 {{phNum}}</div>
				</div>
				<ul v-bind:class="[isTestPhNum ? 'notShowIt bankList' : 'bankList']">
					<li v-for = "(k, index) in bankList" @click="checkBank(index)">
						<span class="iconfont icon-card"></span>
						<div class="bankName">{{k.name}}</div>
						<i 
							class="iconfont icon-yes" 
							v-bind:class="[k.checked ? 'active' : '']"
						></i>
					</li>
				</ul>
				<div v-bind:class="[(isTestPhNum && !codePass) ? 'payCode' : 'payCode notShowIt']">
					<div>
						<span>验证码：</span>
						<div class="codeText">
							<input type="text" v-model="payCode" />
						</div>
						<div class="code" @click="achieveCode" v-bind:class="codeClassObject">{{codeTxt}}</div>
					</div>
					<p>请输入银联发送的6位短信验证码</p>
					<p>收不到短信，获取语音验证码 &gt;</p>
				</div>
				<div v-bind:class="[(isTestPhNum && !codePass) ? 'payCode' : 'payCode notShowIt']">
					
				</div>
				<div v-bind:class="[isTestPhNum ? 'notShowIt addBankCard' : 'addBankCard']" @click="addBankCard">
					<span class="iconfont icon-honor2"></span>
					<div class="bankName">添加本人储蓄卡还款(<b>无限额</b>)</div>
					<i class="iconfont icon-enter"></i>
				</div>
				<div v-bind:class="[codePass ? 'notShowIt' : submitPayStyle]" @click="payIt">确认还款</div>
			</div>
		</div>
		<div class="um-content">
			<!-- 空图片展示 -->
			<div id="content"></div>
            <div class="banner">
                <img src="../../img/banner.png" alt="">
            </div>
            <ul class="repayList">
                <li v-for = "(k, index) in items" @click="checkIt(index)">
                    <div class="l-con">
                        <span
							class="choose"
							v-bind:class="[k.checked ? 'borderNone' : 'borderActive']"
						>
                            <i
	                            v-bind:class="[k.checked ? '' : 'iconNone']"
                            	class="iconfont icon-yes"
                            ></i>
                        </span>
                        <span class="repayDate">还款日{{k.date}}</span>
                        <span class="money">￥{{k.money}}</span>
                        <span class="car">{{k.car}}</span>
                    </div>
                    <div class="r-con">剩余<span>{{k.surplus}}</span>天</div>
                </li>
            </ul>
		</div>
        <div class="um-footer">
            <div class="footer-l">
                <span>还款金额： </span>
                <i>￥{{total}}</i>
            </div>
            <div
				class="footer-r"
				v-bind:class="[this.submit ? '' : 'disabled']"
				@click="toSubmit"
			>还款</div>
		</div>
	</div>
	<script type="text/javascript">
		// 数据
		var stockData = [
			{
				date:"12/27",
				money:"3819.23",
				car:"别克昂科威2017豪华型",
				surplus:"12"
			},
			{
				date:"12/28",
				money:"3819.23",
				car:"别克昂科威2017豪华型",
				surplus:"0"
			},
			{
				date:"12/29",
				money:"3819.23",
				car:"别克昂科威2017豪华型",
				surplus:"2"
			},
			{
				date:"12/29",
				money:"3819.23",
				car:"别克昂科威2017豪华型",
				surplus:"2"
			},
			{
				date:"12/29",
				money:"3819.23",
				car:"别克昂科威2017豪华型",
				surplus:"2"
			}
		];
		var bankData = [
			{
				name:"中国建设银行"
			},
			{
				name:"中国农业银行"
			},
			{
				name:"中国工商银行"
			},
			{
				name:"中国招商银行"
			}
		];
		stockData.forEach(function (e) {
			e.checked = false;
		});
		bankData.forEach(function (e) {
			e.checked = false;
		});
        var stock = new Vue({
            el:'#index',
			data:{
				// 账单列表
				items:stockData,
				// 银行列表
				bankList:bankData,
				// 还款总额
				total:"0.00",
				// 是否可点击还款
				submit:false,
				// 遮罩层显隐
				mask:false,
				// 银行选择
				bankChoose:"",
				// 确认还款步骤
				isTestPhNum:false,
				// 确认还款手机验证码
				payCode:"",
				// 用户手机号
				phNum:"186****8888",
				// 验证码区域文本
				codeTxt:"免费获取",
				// 获取的验证码
				getCode:"",
				// 定时器ID
				codeTimer: null,
				// 确认还款手机验证码是否正确
				codePass:false,
				// 付款是否成功
				paySuccess:false
			},
			computed: {
				botMaskStyle:function () {
					return {
						botMask: true,
						botMaskActive: this.mask
					}
				},
				choosePayMethodStyle:function () {
					return {
						choosePayMethod: true,
						choosePayMethodActive: this.mask
					}
				},
				submitPayStyle:function () {
					return {
						submitPay: true,
						submitPayActive: (this.bankChoose && !this.isTestPhNum) || (this.payCode)
					}
				},
				codeClassObject:function () {
					return {
						getcodeUnClick: this.codeTxt != "免费获取"
					}
				}
			},
			methods:{
				// 选择账单项
				checkIt:function (index){
					this.items[index].checked = !this.items[index].checked;
					this.submit = this.items.some(function (e) {
						return e.checked == true;
					});
					if (this.items[index].checked) {
						this.total = (Number(this.total) + Number(this.items[index].money)).toFixed(2);
					} else {
						this.total = (Number(this.total) - Number(this.items[index].money)).toFixed(2);
					}
				},
				// 点击还款按钮
				toSubmit:function (){
					if (this.submit) {
						/* 重置状态 */
						this.mask = true;
						this.bankChoose = "";
						this.isTestPhNum = false;
						this.payCode = "";
						this.bankList.forEach(function (e) {
							e.checked = false;
						});
					}
				},
				// 关闭遮罩层
				closeMask:function (){
					this.mask = false;
				},
				// 选择银行
				checkBank:function (index){
					this.bankList.forEach(function (e) {
						e.checked = false;
					});
					this.bankList[index].checked = !this.bankList[index].checked;
					this.bankChoose = this.bankList[index].name;
				},
				// 确认还款
				payIt:function (){
					if (!this.isTestPhNum) {
						// 选择银行时点击确认还款
						if (this.bankChoose) {
							this.isTestPhNum = true;
						}
					} else {
						// 手机验证时点击确认还款
						if (this.payCode) {
							// 在此请求，判断codePass
							this.codePass = true;
							// codePass正确回调中请求付款
							// 付款成功
							this.paySuccess = true;
						}
					}
				},
				// 还款记录
				record:function (){
					this.mask = false;
					summer.openWin({
						id:'payRecord',
						url:'html/stock/payRecord.html',
						create:false,
						type:'actionBar',
						actionBar: {
							title: "还款记录",
							titleColor: "#ffffff", //注意必须是6位数的颜色值。（3位数颜色值会不正常）
							backgroundColor: "#039be5",
							leftItem:{
								image: "img/back.png",
								method:"",//返回按钮自定义事件
								text:"返回",
								textColor:"#ffffff"  //返回文字颜色，注意必须是6位数的颜色值。（3位数颜色值会不正常）
							}
						}
					});
				},
				// 添加银行卡
				addBankCard:function (){
					this.mask = false;
					summer.openWin({
						id:'addBankCard',
						url:'html/stock/addBankCard.html',
						create:false,
						type:'actionBar',
						actionBar: {
							title: "银行卡",
							titleColor: "#ffffff", //注意必须是6位数的颜色值。（3位数颜色值会不正常）
							backgroundColor: "#039be5",
							leftItem:{
								image: "img/back.png",
								method:"",//返回按钮自定义事件
								text:"返回",
								textColor:"#ffffff"  //返回文字颜色，注意必须是6位数的颜色值。（3位数颜色值会不正常）
							},
							rightItems: [{
								type: "text",
								text: "管理",
								textColor: "#ffffff",
								method: ""
							}]
						}
					});
				},
				// 进个人中心
				personal:function (){
					this.mask = false;
					summer.openWin({
						id:'personal',
						url:'html/stock/personal.html',
						create:false,
						type:'actionBar',
						actionBar: {
							title: "个人中心",
							titleColor: "#ffffff", //注意必须是6位数的颜色值。（3位数颜色值会不正常）
							backgroundColor: "#039be5",
							leftItem:{
								image: "img/back.png",
								method:"",//返回按钮自定义事件
								text:"返回",
								textColor:"#ffffff"  //返回文字颜色，注意必须是6位数的颜色值。（3位数颜色值会不正常）
							}
						}
					});
				},
				// 获取验证码
                achieveCode: function () {
                    var This = this;
                    if (this.codeTxt == "免费获取") {
                        This.getCode = "";
                        This.codeTxt = "60s";
                        var n = 59;
                        this.codeTimer = setInterval(function () {
                            This.codeTxt = n + "s";
                            if (n < 0) {
                                This.codeTxt = "免费获取";
                                clearInterval(this.codeTimer);
                                This.codeTimer = null;
                            };
                            n--;
                        }, 1000);
                        /* summer.showProgress();
                        // 获取验证码接口
                        ajaxRequest({
                        	type: 'post',
                        	url: 'appservice/login/custLogin',
                        	param: {
                        		PHONE: This.phoneNum
                        	}
                        }, function (res) {
                        	summer.hideProgress();
                        	var Data;
                        	if (Object.prototype.toString.call(res.data) === '[object String]') {
                        		Data = JSON.parse(res.data);
                        	} else {
                        		Data = res.data;
                        	}
                        	if (Data.flag == 1) {
                        		if (Data.datas.FLAG == "true") {
                        			summer.toast({
                        				msg: "验证码已发送"
                        			});
                        			This.customerInfo = Data.datas;
                        			This.getCode = Data.datas.SMSCODE;
                        			This.codeTxt = "60s";
                        			var n = 59;
                        			this.codeTimer = setInterval(function () {
                        				This.codeTxt = n + "s";
                        				if (n < 0) {
                        					This.codeTxt = "获取验证码";
                        					clearInterval(this.codeTimer);
                        					This.codeTimer = null;
                        				};
                        				n--;
                        			}, 1000);
                        		} else if (Data.datas.FLAG == "false") {
                        			summer.toast({
                        				msg: "发送短信失败"
                        			});
                        		} else if (Data.datas.FLAG == "ufalse") {
                        			summer.toast({
                        				msg: Data.datas.STATE ? Data.datas.STATE : "未找到该用户"
                        			});
                        		} else {
                        			summer.toast({
                        				msg: "获取验证码失败"
                        			});
                        		}
                        	} else {
                        		summer.toast({
                        			msg: "获取验证码失败"
                        		});
                        	}
                        }, function (err) {
                        	summer.hideProgress();
                        	summer.toast({
                        		msg: "系统内部异常"
                        	});
                        	console.log(err);
                        }); */
                    } else {
                        summer.toast({
                            msg: "请勿连续发送"
                        });
                    }
                }
			}
        });
	</script>
</body>

</html>
