<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1">
		<meta charset="UTF-8">
		<title>添加车辆</title>
		<link rel="stylesheet" href="../../css/iuapmobile.um.css">
		<link rel="stylesheet" href="../../css/fonts/iconfont.css">
		<link rel="stylesheet" href="../../css/mint.css">
		<link rel="stylesheet" href="css/baseMessage.css">
		<script src="../../js/summer.js" ></script>
		<script src="../../js/jquery.min.js" ></script>
		<script src="../../js/font.js" ></script>
		<script src="../../js/vue.js" ></script>
		<script src="../../js/mint.js" ></script>
		<script src="../../js/Frameworks/iuapmobile.frameworks.ui.js" ></script>
	</head>
	<body>
		<div class="um-win" id="baseMessage" v-cloak>
			<div class="um-content baseMessage">
				<ul>
					<li @click="surePickerProgram">
						<p class="pl10 pr10 tr">
							<span class="fl">项目类型</span>
							 <span class="right"><span v-if='programStyle' class="first">{{programStyle}}</span><span v-else class="second">请选择</span> <i class="icon iconfont icon-enter"></i></span>
						</p>
					</li>
					<li @click="surePickerTask">
						<p class="pl10 pr10 tr ">
							<span class="fl">省份</span>
							<span class="right"><span v-if='taskStyle'  class="first">{{taskStyle}}</span><span v-else class="second">请选择</span> <i class="icon iconfont icon-enter"></i></span>
						</p>
					</li>
			<!--		<li>
						<p class="pl10 pr10 tr" style="line-height:0.88rem;">
							<span class="fl">合同签署方式</span>
							<span class="isGroup">
								<span @click="changContractStatus($event,'electron')" class='active'>
									电子
								</span>
								<span @click="changContractStatus($event,'paper')" class="">
									纸质
								</span></span>
						</p>
					</li>
					<li>
						<p class="pl10 pr10 tr" style="line-height:0.88rem;">
								 <span class="fl">是否团单</span>
							<span class="isGroup">
									<span @click="changGroupStatus($event,'no')" class='active'>
										否
									</span>
									<span @click="changGroupStatus($event,'yes')" class="">
										是
									</span>
							</span>
						</p>
					</li>-->
				</ul>


			</div>

			<div class="um-footer">
				<mt-popup v-model="pickerProgramStatus" position='bottom' class="pickerColor">
						<mt-picker :slots="slots1" @change="onValuesChange1"></mt-picker>
						<p>
							<span class="fl" @click="surePickerProgram">取消</span><span class="fr" @click="surePickerProgram('confirm')">确定</span>
						</p>
				</mt-popup>
				<mt-popup v-model="pickerTaskStatus" position='bottom' class="pickerColor">
						<mt-picker :slots="slots2" @change="onValuesChange2"></mt-picker>
						<p>
							<span class="fl" @click="surePickerTask">取消</span><span class="fr" @click="surePickerTask('confirm')">确定</span>
						</p>
				</mt-popup>
			</div>
		</div>
		<script src="../../js/common.js" ></script>
		<script>
		  summerready=function(){
			  var baseData=summer.pageParam.baseData;
			  let _customId=summer.pageParam.customId;
			  baseMessage.totalData=baseData;
			  baseMessage.customId=_customId;
			  baseData.AreaList.map((e,i) =>{
					baseMessage.slots2[0].values.push(e.AREA_NAME);
			  })
			  baseData.business.map((e,i) =>{
					baseMessage.slots1[0].values.push(e.FLAG);
			  })
		  }
			function save(){
				baseMessage.save();
			}
			var baseMessage=new Vue({
			el:'#baseMessage',
			data() {
				return {
					contractStatus : 'electron',
					GroupStatus : 'no',
					programStyle : '',
					taskStyle:'',
					holdPrice : 100,
					pickerProgramStatus:false,
					pickerTaskStatus:false,
					pickerProgram:'',
					pickerTask:'',
					slots1 : [{
						flex : 1,
						values : [],
						defaultIndex :0,
						className : 'slot1',
						textAlign : 'center'
					}],
					slots2 : [{
						flex : 1,
						values : [],
						defaultIndex : 0,
						className : 'slot2',
						textAlign : 'center'
					}],
					totalData:"",
					customId:""
				}
			},
			created() {

			},
			 methods: {
				goBack() {
					summer.closeWin();
				},
				changContractStatus(e, status) {
					$(e.currentTarget).addClass('active').siblings('.active').removeClass('active');
					this.contractStatus = status;
				},
				changGroupStatus(e, status) {
					$(e.currentTarget).addClass('active').siblings('.active').removeClass('active');
					this.GroupStatus = status;
				},
				onValuesChange1(picker, values) {
					this.pickerProgram = values[0];
				},
				onValuesChange2(picker, values) {
					this.pickerTask = values[0];
				},
				surePickerProgram(param) {
					this.pickerProgramStatus = !this.pickerProgramStatus;
					if (param == 'confirm') {
						this.programStyle = this.pickerProgram;
					}
				},
				surePickerTask(param) {
					this.pickerTaskStatus = !this.pickerTaskStatus;
					if (param == 'confirm') {
						this.taskStyle = this.pickerTask;
					}
				},
				save() {
					if(this.programStyle==""){
						summer.toast({msg:"请选择项目类型"});
						return;
					}else if(this.taskStyle==""){
						summer.toast({msg:"请选择省份"});
						return;
					}
					//此时需要调后端的ajax请求数据
					let _programStyle=this.programStyle;
					let _area_id=this.taskStyle;
					let PLATFORM_TYPE,AREAID;
					let customId=this.customId;
					baseMessage.totalData.business.map((e,i)=>{
						if(e.FLAG==_programStyle){
							PLATFORM_TYPE=baseMessage.totalData.business[i].CODE;
						}
					});
					baseMessage.totalData.AreaList.map((e,i)=>{
						if(e.AREA_NAME==_area_id){
							AREAID=baseMessage.totalData.AreaList[i].AREA_ID;
						}
					});
					summer.showProgress();
					ajaxRequest({
						  type: 'post',
						  url: 'appservice/foundproject/saveProject',
						  param: {
								 "AREA_ID":AREAID,
								 "PLATFORM_TYPE":PLATFORM_TYPE,
								 "CLIENT_ID":customId
						  }
					 }, function (res) {
							  if(res.data.flag==1){
								  console.log(res);
								  let projectId=res.data.datas.PROJECT_ID;
								  summer.hideProgress();
								  summer.toast({msg:"保存成功"});
									summer.execScript({
									    winId: "setProject",
									    script: "addRight('baseMessage','"+projectId+"')"
									});
									summer.closeWin()
							  }
						 }, function (err) {
							alert(err);
							 console.log(err);
								 summer.hideProgress();
						});
				}
			}
			});

		</script>
	</body>
</html>
